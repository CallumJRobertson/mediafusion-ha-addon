#include <tunables/global>

profile mediafusion flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>

  # Allow S6 Init and Run script
  /init rix,
  /run.sh rix,

  # Allow network access
  network inet stream,
  network inet6 stream,
  network inet dgram,
  network inet6 dgram,
  network netlink raw,

  # WireGuard support
  capability net_admin,
  capability net_raw,

  # File access
  /data/** rwk,
  /config/** r,
  /ssl/** r,
  /run/** rw,
  /tmp/** rwk,
  /var/** rwk,
  /proc/** r,
  /sys/** r,

  # PostgreSQL
  /usr/lib/postgresql/** rix,
  /var/lib/postgresql/** rwk,
  /run/postgresql/** rwk,

  # Redis
  /usr/bin/redis-* rix,

  # Python
  /usr/bin/python* rix,
  /usr/lib/python*/** r,
  /app/** rwk,

  # Allow execution
  /bin/** rix,
  /usr/bin/** rix,
  /usr/sbin/** rix,
  /lib/** mr,
  /usr/lib/** mr,
}
